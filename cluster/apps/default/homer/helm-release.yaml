---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: homer
  namespace: default
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: homer
      version: 6.0.0
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home-charts
        namespace: flux-system
  dependsOn:
    - name: longhorn
  values:
    image:
      repository: b4bz/homer
      tag: 21.07.1
      pullPolicy: IfNotPresent
    ingress:
      main:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: "nginx"
        hosts:
          - host: "homer.${SECRET_DOMAIN}"
            paths:
              - path: /
                pathType: Prefix
        tls:
          - hosts:
              - "homer.${SECRET_DOMAIN}"
    persistence:
      config:
        enabled: true
        existingClaim: homer-config
        mountPath: /www/assets
    configmap:
      enabled: true
      config: |
        # Homepage configuration
        # See https://fontawesome.com/icons for icons options
        title: "K8s Home Dashboard"
        subtitle: "K8s"
        # logo: "assets/tools/k8s.png"
        header: true
        footer: false
        connectivityCheck: true
        columns: "5"
        # Optional theme customization
        theme: default
        colors:
          light:
            highlight-primary: "#3367d6"
            highlight-secondary: "#4285f4"
            highlight-hover: "#5a95f5"
            background: "#f5f5f5"
            card-background: "#ffffff"
            text: "#363636"
            text-header: "#ffffff"
            text-title: "#303030"
            text-subtitle: "#424242"
            card-shadow: rgba(0, 0, 0, 0.1)
            link-hover: "#363636"
            # background-image: "assets/tools/chain_matrix.png"
          dark:
            highlight-primary: "#3367d6"
            highlight-secondary: "#4285f4"
            highlight-hover: "#5a95f5"
            background: "#131313"
            card-background: "#2b2b2b"
            text: "#eaeaea"
            text-header: "#ffffff"
            text-title: "#fafafa"
            text-subtitle: "#f5f5f5"
            card-shadow: rgba(0, 0, 0, 0.4)
            link-hover: "#ffdd57"
            # background-image: "assets/tools/chain_matrix.png"
        links:
          - name: "GitOps"
            # icon: "fab fa-github"
            url: "https://github.com/ground7/bramble-iac"
            target: "_blank"
        services:
          - name: "Devices"
            # icon: "fas fa-server"
            items:
              - name: "Longhorn"
                # logo: "assets/tools/scale.png"
                # subtitle: "Longhorn"
                tag: "device"
                url: "https://longhorn.${SECRET_DOMAIN}"
                target: "_blank"